local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local rootPart = character:WaitForChild("HumanoidRootPart")

-- UI
local screenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))

-- ปุ่มเปิด/ปิด Block (กระโดด)
local blockButton = Instance.new("TextButton")
blockButton.Size = UDim2.new(0, 150, 0, 50)
blockButton.Position = UDim2.new(0, 20, 0, 100)
blockButton.Text = "Block: OFF"
blockButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
blockButton.TextColor3 = Color3.new(1, 1, 1)
blockButton.Font = Enum.Font.SourceSansBold
blockButton.TextSize = 22
blockButton.Parent = screenGui

-- ปุ่มเปิด/ปิด Walk Mode
local walkButton = Instance.new("TextButton")
walkButton.Size = UDim2.new(0, 150, 0, 50)
walkButton.Position = UDim2.new(0, 20, 0, 160)
walkButton.Text = "Walk Mode: OFF"
walkButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
walkButton.TextColor3 = Color3.new(1, 1, 1)
walkButton.Font = Enum.Font.SourceSansBold
walkButton.TextSize = 22
walkButton.Parent = screenGui

-- ปุ่มเปิด/ปิด ESP
local espButton = Instance.new("TextButton")
espButton.Size = UDim2.new(0, 150, 0, 50)
espButton.Position = UDim2.new(0, 20, 0, 220)
espButton.Text = "ESP: OFF"
espButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
espButton.TextColor3 = Color3.new(1, 1, 1)
espButton.Font = Enum.Font.SourceSansBold
espButton.TextSize = 22
espButton.Parent = screenGui

-- สถานะ
local blockEnabled = false
local walkEnabled = false
local espEnabled = false

-- Toggle Block
blockButton.MouseButton1Click:Connect(function()
    blockEnabled = not blockEnabled
    if blockEnabled then
        blockButton.Text = "Block: ON"
        blockButton.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
    else
        blockButton.Text = "Block: OFF"
        blockButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
    end
end)

-- Toggle Walk Mode
walkButton.MouseButton1Click:Connect(function()
    walkEnabled = not walkEnabled
    if walkEnabled then
        walkButton.Text = "Walk Mode: ON"
        walkButton.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
    else
        walkButton.Text = "Walk Mode: OFF"
        walkButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
    end
end)

-- Toggle ESP
espButton.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    if espEnabled then
        espButton.Text = "ESP: ON"
        espButton.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
        for _, p in pairs(Players:GetPlayers()) do
            if p ~= player and p.Character then
                local highlight = Instance.new("Highlight")
                highlight.Adornee = p.Character
                highlight.FillColor = Color3.fromRGB(0, 255, 0)
                highlight.OutlineColor = Color3.fromRGB(0, 255, 0)
                highlight.Parent = p.Character
            end
        end
    else
        espButton.Text = "ESP: OFF"
        espButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
        for _, p in pairs(Players:GetPlayers()) do
            if p.Character then
                for _, h in pairs(p.Character:GetChildren()) do
                    if h:IsA("Highlight") then
                        h:Destroy()
                    end
                end
            end
        end
    end
end)

-- ฟังกระโดดสร้างบล็อก
UserInputService.JumpRequest:Connect(function()
    if blockEnabled then
        local block = Instance.new("Part")
        block.Size = Vector3.new(6, 1, 6)
        block.Anchored = true
        block.CanCollide = true
        block.Color = Color3.fromRGB(255, 200, 50)
        block.CFrame = CFrame.new(rootPart.Position - Vector3.new(0, 3, 0))
        block.Parent = workspace
        game:GetService("Debris"):AddItem(block, 5)
    end
end)

-- ฟังการเดินเพื่อสร้างบล็อกอัตโนมัติ (Walk Mode)
local lastPosition = rootPart.Position
RunService.RenderStepped:Connect(function()
    if walkEnabled then
        local distance = (rootPart.Position - lastPosition).Magnitude
        if distance > 1 then -- ขยับเกิน 1 stud จะสร้างบล็อก
            local block = Instance.new("Part")
            block.Size = Vector3.new(6, 1, 6)
            block.Anchored = true
            block.CanCollide = true
            block.Color = Color3.fromRGB(255, 200, 50)
            block.CFrame = CFrame.new(rootPart.Position - Vector3.new(0, 3, 0))
            block.Parent = workspace
            game:GetService("Debris"):AddItem(block, 5)
            lastPosition = rootPart.Position
        end
    else
        lastPosition = rootPart.Position
    end
end)

-- ฟังผู้เล่นเข้ามาใหม่ (ESP)
Players.PlayerAdded:Connect(function(p)
    p.CharacterAdded:Connect(function(char)
        if espEnabled then
            local highlight = Instance.new("Highlight")
            highlight.Adornee = char
            highlight.FillColor = Color3.fromRGB(0, 255, 0)
            highlight.OutlineColor = Color3.fromRGB(0, 255, 0)
            highlight.Parent = char
        end
    end)
end)
